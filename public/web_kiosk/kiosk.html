<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartMealAI Kiosk</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- T·ªáp CSS t√πy ch·ªânh (Ph·∫£i ƒë·∫∑t sau Tailwind) -->
    <link rel="stylesheet" href="../css/global.css">
</head>
<body class="min-h-screen overflow-hidden p-4 md:p-8">

    <!-- Thanh Taskbar Tr√™n C√πng -->
    <nav class="glass-panel w-full p-3 px-6 flex justify-between items-center fixed top-4 left-4 right-4 mx-auto max-w-[98%] z-50">
        <!-- Tr√°i: ƒêi·ªÅu h∆∞·ªõng -->
        <div class="flex items-center space-x-6">
            <a href="#" class="flex items-center text-white/90 hover:text-white transition" title="Trang Ch·ªß">
                <i class="fa-solid fa-house fa-lg"></i>
            </a>
            <button id="btnAboutUs" class="flex items-center text-white/90 hover:text-white transition" title="V·ªÅ ch√∫ng t√¥i">
                <i class="fa-solid fa-book fa-lg"></i>
            </button>
        </div>
        
        <!-- Ph·∫£i: Ng∆∞·ªùi d√πng -->
        <div class="flex items-center space-x-6">
            <div class="flex items-center text-white/90" title="Tr·∫°ng th√°i kh√°ch h√†ng">
                <span id="userIcon" class="mr-2">
                    <!-- Icon s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o -->
                </span>
                <span id="userDisplay" class="font-semibold">ƒêang t·∫£i...</span>
            </div>
            <button id="btnLogout" class="flex items-center text-red-300 hover:text-red-200 transition" title="ƒêƒÉng xu·∫•t">
                <i class="fa-solid fa-right-from-bracket fa-lg"></i>
            </button>
        </div>
    </nav>

    <!-- N·ªôi dung ch√≠nh (Camera v√† K·∫øt qu·∫£) -->
    <main class="w-full h-[calc(100vh-160px)] mt-[70px] flex flex-col md:flex-row gap-6">
        
        <!-- C·ªôt Tr√°i: Camera & ƒêi·ªÅu khi·ªÉn -->
        <div class="w-full md:w-3/5 h-full flex flex-col gap-4">
            <!-- Khung Camera -->
            <div class="glass-panel w-full h-[calc(100%-80px)] p-3 relative overflow-hidden flex items-center justify-center">
                <!-- Video Feed -->
                <video id="cameraFeed" class="w-full h-full object-cover rounded-lg" autoplay playsinline muted></video>
                
                <!-- Image Preview (cho ch·∫ø ƒë·ªô Photo) -->
                <img id="imagePreview" src="https://placehold.co/640x480/png?text=Ch%E1%BB%8Dn+%E1%BA%A3nh" class="w-full h-full object-cover rounded-lg hidden" alt="Image Preview"/>
                
                <!-- Spinner khi t·∫£i camera -->
                <div id="cameraSpinner" class="absolute inset-0 flex items-center justify-center bg-black/30 text-white z-10">
                    <i class="fa-solid fa-spinner fa-spin fa-2x"></i>
                    <span class="ml-2">ƒêang t·∫£i Camera...</span>
                </div>
            </div>
            
            <!-- N√∫t Chuy·ªÉn Ch·∫ø ƒê·ªô & Ch·ª•p -->
            <div id="mainControls" class="glass-panel w-full h-[80px] p-3 flex justify-between items-center">
                <!-- Chuy·ªÉn ch·∫ø ƒë·ªô -->
                <div class="flex bg-black/20 rounded-xl p-1">
                    <button id="btnCameraMode" class="glass-button glass-button-active px-6 py-2 rounded-lg flex items-center gap-2">
                        <i class="fa-solid fa-camera"></i> CAMERA
                    </button>
                    <button id="btnPhotoMode" class="glass-button px-6 py-2 rounded-lg flex items-center gap-2">
                        <i class="fa-solid fa-image"></i> PHOTO
                    </button>
                </div>

                <!-- N√∫t H√†nh ƒê·ªông -->
                <div id="cameraActions" class="">
                    <button id="btnSnapshot" class="px-6 py-4 bg-red-500 rounded-xl flex items-center gap-2 text-white font-semibold transition hover:bg-red-600 active:scale-95">
                        <i class="fa-solid fa-camera"></i> CH·ª§P ·∫¢NH & T√çNH TI·ªÄN
                    </button>
                </div>
                <div id="photoActions" class="hidden relative">
                    <input type="file" id="fileUpload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*">
                    <button id="btnUpload" class="px-6 py-4 bg-indigo-500 rounded-xl flex items-center gap-2 text-white font-semibold transition hover:bg-indigo-600">
                        <i class="fa-solid fa-upload"></i> T·∫¢I ·∫¢NH & T√çNH TI·ªÄN
                    </button>
                </div>
            </div>

            <!-- N√∫t Reset (ch·ªâ hi·ªán sau khi th√†nh c√¥ng) -->
            <button id="btnReset" class="hidden glass-panel w-full h-[80px] p-3 flex justify-center items-center text-xl font-semibold bg-indigo-500 hover:bg-indigo-600 transition">
                <i class="fa-solid fa-arrow-rotate-right mr-2"></i>Ph·ª•c V·ª• Kh√°ch Ti·∫øp Theo
            </button>

        </div>

        <!-- C·ªôt Ph·∫£i: K·∫øt qu·∫£ & Thanh to√°n -->
        <div class="w-full md:w-2/5 h-full glass-panel p-5 flex flex-col relative overflow-hidden">
            
            <!-- Tr·∫°ng th√°i: Ch·ªù -->
            <div id="predictionWaiting" class="flex flex-col items-center justify-center h-full text-center">
                <i class="fa-solid fa-camera-viewfinder fa-4x text-white/50 mb-4"></i>
                <h2 class="text-2xl font-semibold mb-2">Ch·ªù Qu√©t Khay C∆°m</h2>
                <p class="text-white/60">S·ª≠ d·ª•ng CAMERA ho·∫∑c PHOTO ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
            </div>

            <!-- Tr·∫°ng th√°i: ƒêang T·∫£i (Loading) -->
            <div id="predictionLoading" class="hidden flex-col items-center justify-center h-full text-center">
                <i class="fa-solid fa-microchip fa-spin fa-4x text-white/80 mb-4"></i>
                <h2 class="text-2xl font-semibold mb-2">AI ƒêang Ph√¢n T√≠ch...</h2>
                <p class="text-white/60">Qu√° tr√¨nh n√†y m·∫•t v√†i gi√¢y. Vui l√≤ng ch·ªù.</p>
                <!-- Debug: Hi·ªÉn th·ªã 5 ·∫£nh ƒë√£ c·∫Øt -->
                <div id="segmentationResults" class="flex gap-2 mt-4 p-2 bg-black/20 rounded-lg"></div>
            </div>

            <!-- Tr·∫°ng th√°i: K·∫øt Qu·∫£ -->
            <div id="predictionResults" class="hidden h-full flex-col">
                <h2 class="text-2xl font-bold mb-3 text-center">Chi Ti·∫øt H√≥a ƒê∆°n</h2>
                <!-- Danh s√°ch m√≥n ƒÉn -->
                <div class="flex-grow overflow-y-auto results-scroll pr-2">
                    <ul id="predictionResultsList" class="space-y-3">
                        <!-- JS s·∫Ω ch√®n k·∫øt qu·∫£ v√†o ƒë√¢y -->
                    </ul>
                </div>
                
                <!-- Ph√¢n t√≠ch dinh d∆∞·ª°ng -->
                <div class="mt-4 pt-4 border-t border-white/20">
                    <h3 class="font-semibold text-lg mb-2">Ph√¢n T√≠ch Dinh D∆∞·ª°ng (T·ªïng)</h3>
                    <div class="grid grid-cols-4 gap-2 text-center text-sm">
                        <div class="bg-white/10 p-2 rounded-lg"><span id="totalCalories" class="font-bold block text-lg">0</span> Calo</div>
                        <div class="bg-white/10 p-2 rounded-lg"><span id="totalProtein" class="font-bold block text-lg">0g</span> ƒê·∫°m</div>
                        <div class="bg-white/10 p-2 rounded-lg"><span id="totalFat" class="font-bold block text-lg">0g</span> B√©o</div>
                        <div class="bg-white/10 p-2 rounded-lg"><span id="totalCarbs" class="font-bold block text-lg">0g</span> Carb</div>
                    </div>
                    <p id="nutritionRecommendation" class="text-xs text-center text-white/70 italic mt-2">Khuy·∫øn ngh·ªã dinh d∆∞·ª°ng...</p>
                </div>
                
                <!-- Khu v·ª±c Voucher (Ch·ªâ cho VIP) -->
                <div id="voucherSection" class="hidden mt-4 pt-4 border-t border-white/20">
                    <h3 class="font-semibold text-lg mb-2 text-yellow-400">üéÅ ∆Øu ƒê√£i VIP</h3>
                    <div class="flex justify-around">
                        <button class="voucher-btn glass-button px-4 py-2" data-discount="0.10">Gi·∫£m 10%</button>
                        <button class="voucher-btn glass-button px-4 py-2" data-discount="0.20">Gi·∫£m 20%</button>
                        <button class="voucher-btn glass-button px-4 py-2" data-discount="0.30">Gi·∫£m 30%</button>
                    </div>
                </div>

                <!-- T·ªïng ti·ªÅn -->
                <div class="mt-4 pt-4 border-t border-white/20 flex justify-between items-center">
                    <span class="text-xl font-medium">T·ªîNG TI·ªÄN</span>
                    <span id="finalPrice" data-original-price="0" class="text-3xl font-bold text-yellow-300">0 VNƒê</span>
                </div>
                
                <!-- QR Code Thanh to√°n -->
                <div id="qrCodeContainer" class="hidden text-center mt-4">
                    <h3 class="font-semibold text-lg">THANH TO√ÅN</h3>
                    <p class="text-sm text-white/70 mb-2">Qu√©t m√£ ƒë·ªÉ thanh to√°n</p>
                    <canvas id="qrCodeCanvas" class="mx-auto bg-white p-2 rounded-lg"></canvas>
                </div>
            </div>
            
            <!-- Tr·∫°ng th√°i: Th√†nh c√¥ng -->
            <div id="paymentSuccess" class="hidden flex-col items-center justify-center h-full text-center">
                <i class="fa-solid fa-circle-check fa-4x text-green-400 mb-4"></i>
                <h2 class="text-2xl font-semibold mb-2">Thanh To√°n Th√†nh C√¥ng!</h2>
                <p class="text-white/60">C·∫£m ∆°n qu√Ω kh√°ch. Ch√∫c qu√Ω kh√°ch ngon mi·ªáng!</p>
            </div>
        </div>
    </main>

    <!-- Thanh Taskbar D∆∞·ªõi C√πng -->
    <footer class="glass-panel w-full p-3 px-6 flex justify-around items-center fixed bottom-4 left-4 right-4 mx-auto max-w-[98%] z-50">
        <button class="flex flex-col items-center text-white/90 hover:text-white transition" title="Menu">
            <i class="fa-solid fa-book-open"></i>
            <span class="text-xs mt-1">Menu</span>
        </button>
        <button class="flex flex-col items-center text-white/90 hover:text-white transition" title="Li√™n h·ªá">
            <i class="fa-solid fa-phone"></i>
            <span class="text-xs mt-1">Li√™n h·ªá</span>
        </button>
        <button class="flex flex-col items-center text-white/90 hover:text-white transition" title="Chatbot AI">
            <i class="fa-solid fa-comments"></i>
            <span class="text-xs mt-1">Chatbot AI</span>
        </button>
        <!-- N√∫t TTS (H·ªó tr·ª£ khi·∫øm th·ªã) -->
        <button id="btnTTS" class="flex flex-col items-center text-white/90 hover:text-white transition" title="ƒê·ªçc Gi·ªçng N√≥i (H·ªó tr·ª£ khi·∫øm th·ªã)">
            <i class="fa-solid fa-volume-high"></i>
            <span class="text-xs mt-1">Gi·ªçng N√≥i</span>
        </button>
    </footer>

    <!-- Modal "V·ªÅ Ch√∫ng T√¥i" -->
    <div id="aboutUsModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 modal-backdrop">
        <div class="glass-panel max-w-2xl w-full max-h-[80vh] p-6 rounded-2xl relative">
            <button id="btnCloseModal" class="absolute top-4 right-4 text-white/50 hover:text-white transition">
                <i class="fa-solid fa-xmark fa-2x"></i>
            </button>
            <h2 class="text-2xl font-bold text-center mb-4">üè´ L·ªäCH S·ª¨ PH√ÅT TRI·ªÇN ·ª®NG D·ª§NG SMARTCANTEEN</h2>
            <div class="overflow-y-auto max-h-[calc(80vh-100px)] pr-2 space-y-3 text-white/90 results-scroll">
                <p><strong>Gi·ªõi thi·ªáu chung:</strong> SMARTCANTEEN l√† m·ªôt ·ª©ng d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o ƒë∆∞·ª£c ph√°t tri·ªÉn v·ªõi m·ª•c ti√™u n√¢ng cao tr·∫£i nghi·ªám ƒÉn u·ªëng t·∫°i cƒÉng tin tr∆∞·ªùng h·ªçc v√† doanh nghi·ªáp. ·ª®ng d·ª•ng t√≠ch h·ª£p c√¥ng ngh·ªá nh·∫≠n di·ªán h√¨nh ·∫£nh (AI ‚Äì CNN), x·ª≠ l√Ω gi·ªçng n√≥i, v√† thanh to√°n t·ª± ƒë·ªông nh·∫±m mang l·∫°i quy tr√¨nh ph·ª•c v·ª• nhanh ch√≥ng, minh b·∫°ch v√† th√¢n thi·ªán v·ªõi m·ªçi ƒë·ªëi t∆∞·ª£ng ng∆∞·ªùi d√πng ‚Äì ƒë·∫∑c bi·ªát l√† ng∆∞·ªùi khi·∫øm th·ªã.</p>
                <p><strong>Ngu·ªìn g·ªëc v√† √Ω t∆∞·ªüng:</strong> √ù t∆∞·ªüng v·ªÅ SMARTCANTEEN ƒë∆∞·ª£c kh·ªüi ngu·ªìn v√†o ƒë·∫ßu nƒÉm 2025 t·ª´ m·ªôt nh√≥m sinh vi√™n ng√†nh ƒêi·ªÅu khi·ªÉn th√¥ng minh v√† t·ª± ƒë·ªông h√≥a thu·ªôc  ƒê·∫°i h·ªçc Kinh t·∫ø TP. H·ªì Ch√≠ Minh (UEH). Nh√≥m nh·∫≠n th·∫•y r·∫±ng trong th·ª±c t·∫ø, vi·ªác qu·∫£n l√Ω, nh·∫≠n di·ªán m√≥n ƒÉn v√† thanh to√°n trong cƒÉng tin truy·ªÅn th·ªëng th∆∞·ªùng m·∫•t nhi·ªÅu th·ªùi gian, d·ªÖ sai s√≥t v√† ch∆∞a h·ªó tr·ª£ t·ªët cho c√°c nh√≥m ng∆∞·ªùi d√πng ƒë·∫∑c bi·ªát. T·ª´ ƒë√≥, nh√≥m ƒë√£ ƒë·∫∑t m·ª•c ti√™u: ‚ÄúT·∫°o ra m·ªôt h·ªá th·ªëng th√¥ng minh c√≥ th·ªÉ t·ª± ƒë·ªông nh·∫≠n di·ªán m√≥n ƒÉn, t√≠nh ti·ªÅn, cung c·∫•p th√¥ng tin dinh d∆∞·ª°ng, v√† h·ªó tr·ª£ thanh to√°n nhanh ‚Äì t·∫•t c·∫£ ch·ªâ trong v√†i gi√¢y.‚Äù</p>
                <p><strong>Qu√° tr√¨nh ph√°t tri·ªÉn:</strong><br>
                    üîπ Th√°ng 1/2025: Kh·ªüi ƒë·ªông d·ª± √°n ‚Äì nghi√™n c·ª©u c√¥ng ngh·ªá th·ªã gi√°c m√°y t√≠nh (Computer Vision) v√† m·∫°ng n∆°-ron t√≠ch ch·∫≠p (CNN).<br>
                    üîπ Th√°ng 3/2025: Thu th·∫≠p d·ªØ li·ªáu h√¨nh ·∫£nh th·ª±c t·∫ø t·ª´ cƒÉng tin sinh vi√™n UEH; x√¢y d·ª±ng b·ªô d·ªØ li·ªáu g·ªìm h∆°n 3.000 ·∫£nh c·ªßa c√°c m√≥n ƒÉn ph·ªï bi·∫øn.<br>
                    üîπ Th√°ng 4/2025: Hu·∫•n luy·ªán m√¥ h√¨nh CNN (TensorFlow/Keras) ƒë·∫°t ƒë·ªô ch√≠nh x√°c tr√™n 95% trong vi·ªác nh·∫≠n di·ªán m√≥n ƒÉn.<br>
                    üîπ Th√°ng 6/2025: X√¢y d·ª±ng giao di·ªán web b·∫±ng Flask ‚Äì t√≠ch h·ª£p camera, QR code, v√† h·ªá th·ªëng ƒë·ªçc gi·ªçng n√≥i h·ªó tr·ª£ ng∆∞·ªùi khi·∫øm th·ªã.<br>
                    üîπ Th√°ng 8/2025: Ho√†n thi·ªán phi√™n b·∫£n th·ª≠ nghi·ªám n·ªôi b·ªô (SmartCanteen v1.0) v√† tri·ªÉn khai t·∫°i m·ªôt s·ªë khu cƒÉng tin sinh vi√™n UEH.<br>
                    üîπ Th√°ng 10/2025: Ra m·∫Øt phi√™n b·∫£n tr√¨nh di·ªÖn ch√≠nh th·ª©c, ƒë∆∞·ª£c ƒë√°nh gi√° cao b·ªüi gi·∫£ng vi√™n v√† sinh vi√™n nh·ªù t√≠nh th·ª±c t·∫ø v√† kh·∫£ nƒÉng ·ª©ng d·ª•ng cao.
                </p>
                <p><strong>ƒê·ªôi ng≈© ph√°t tri·ªÉn:</strong> SMARTCANTEEN ƒë∆∞·ª£c ph√°t tri·ªÉn b·ªüi nh√≥m sinh vi√™n UEH:<br>
                    - Nguy·ªÖn Tr·ªçng Ph√∫c<br>
                    - Nguy·ªÖn Th√πy H·∫°nh<br>
                    - Nguy·ªÖn Ti·∫øn Hi·∫øu
                </p>
                <p><strong>C√¥ng ngh·ªá s·ª≠ d·ª•ng:</strong><br>
                    - Ng√¥n ng·ªØ: Python, HTML, CSS, JavaScript<br>
                    - Framework: Flask (Backend), Bootstrap / Tailwind (Frontend)<br>
                    - AI Model: Convolutional Neural Network (CNN ‚Äì TensorFlow/Keras)<br>
                    - C∆° s·ªü d·ªØ li·ªáu: SQLite / CSV<br>
                    - C√¥ng c·ª• h·ªó tr·ª£: OpenCV, Pyttsx3, Qrcode, Pandas
                </p>
                 <p><strong>M·ª•c ti√™u t∆∞∆°ng lai:</strong><br>
                    - M·ªü r·ªông m√¥ h√¨nh sang nh·∫≠n di·ªán m√≥n ƒÉn Vi·ªát tr√™n to√†n qu·ªëc.<br>
                    - T√≠ch h·ª£p h·ªá th·ªëng dinh d∆∞·ª°ng c√° nh√¢n h√≥a, ƒë∆∞a ra g·ª£i √Ω th·ª±c ƒë∆°n theo nhu c·∫ßu calo c·ªßa t·ª´ng ng∆∞·ªùi d√πng.<br>
                    - X√¢y d·ª±ng ·ª©ng d·ª•ng di ƒë·ªông (Android/iOS) cho tr·∫£i nghi·ªám ti·ªán l·ª£i h∆°n.<br>
                    - K·∫øt n·ªëi v·ªõi c√°c h·ªá th·ªëng qu·∫£n l√Ω t√†i ch√≠nh v√† th·∫ª sinh vi√™n UEH ƒë·ªÉ thanh to√°n t·ª± ƒë·ªông.
                </p>
                <p><strong>T·∫ßm nh√¨n:</strong> SMARTCANTEEN h∆∞·ªõng t·ªõi tr·ªü th√†nh h·ªá th·ªëng cƒÉng tin th√¥ng minh to√†n di·ªán, g√≥p ph·∫ßn hi·ªán ƒë·∫°i h√≥a d·ªãch v·ª• ƒÉn u·ªëng h·ªçc ƒë∆∞·ªùng, mang l·∫°i tr·∫£i nghi·ªám nhanh ‚Äì s·∫°ch ‚Äì an to√†n ‚Äì minh b·∫°ch, ƒë·ªìng th·ªùi th·ªÉ hi·ªán kh·∫£ nƒÉng ·ª©ng d·ª•ng th·ª±c t·∫ø c·ªßa AI trong ƒë·ªùi s·ªëng h√†ng ng√†y.</p>
            </div>
        </div>
    </div>
    
    <!-- N·ªôi dung TTS (·∫®n) -->
    <div id="tts-content" class="hidden">Ch∆∞a c√≥ th√¥ng tin</div>

    <!-- C√ÅC TH∆Ø VI·ªÜN JS (Quan tr·ªçng!) -->
    <!-- Firebase (C·∫ßn cho c·∫£ Kiosk v√† Payment) -->
    <!-- S·ª≠ d·ª•ng SDK v9 (module) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js" type="module"></script>
    
    <!-- Th∆∞ vi·ªán t·∫°o QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <!-- Logic ch√≠nh c·ªßa Kiosk (Module) -->
    <script src="../js/camera.js" type="module"></script>
</body>
</html>